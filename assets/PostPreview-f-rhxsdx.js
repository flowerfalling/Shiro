import{R as u,j as e,r as d}from"./index-UszForRq.js";import{R as B,T as H,a as L,F as W,b as D,n as w,B as V,L as q}from"./Markdown-IsKS0DK1.js";import{r as P,R as S,M as O,a as p,N as U,u as h,q as X,b as Z,d as K,P as Q,X as G,g as J}from"./utils-gwk-Vaz-.js";import{m as _,b as y}from"./StyledButton-s4ePjW7Q.js";import{c as $,a as v}from"./helper-H2rpVDS9.js";import{b as R,R as Y}from"./LinkCard-oPf372cO.js";import{a as E,d as b}from"./owner-irBIrw7o.js";import{M as ee,W as te}from"./Gallery-sQat1r2F.js";import{a as C,u as se}from"./utils-JxBG2tY2.js";import{A as I}from"./Collapse-iJ1FFFZR.js";import{P as re}from"./PinIconToggle-yjPnMuu4.js";import"./spring-XYYsQbff.js";import"./RichLink-cHuYWSr_.js";import"./Divider-ohHU5HmP.js";import"./customParseFormat-0m6XgYfy.js";var ne=typeof window>"u",g=ne?u.useEffect:u.useLayoutEffect,ae=0,N=()=>++ae,k=!1;function le(){let[r,t]=u.useState(k?N:void 0);return g(()=>{r===void 0&&t(N()),k=!0},[]),r===void 0?r:`rwb-${r.toString(32)}`}function ie(){return u.useMemo(()=>"useId"in u?u.useId:le,[])()}var j="__wrap_b",x="__wrap_n",M="__wrap_o",T=(r,t,s)=>{s=s||document.querySelector(`[data-br="${r}"]`);let n=s.parentElement,l=f=>s.style.maxWidth=f+"px";s.style.maxWidth="";let a=n.clientWidth,o=n.clientHeight,i=a/2-.25,c=a+.5,m;if(a){for(l(i),i=Math.max(s.scrollWidth,i);i+1<c;)m=Math.round((i+c)/2),l(m),n.clientHeight===o?c=m:i=m;l(c*t+a*(1-t))}s.__wrap_o||typeof ResizeObserver<"u"&&(s.__wrap_o=new ResizeObserver(()=>{self.__wrap_b(0,+s.dataset.brr,s)})).observe(n)},oe=T.toString(),ce='(self.CSS&&CSS.supports("text-wrap","balance")?1:2)',ue=(r,t,s="")=>(s&&(s=`self.${x}!=1&&${s}`),u.createElement("script",{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:(r?"":`self.${x}=self.${x}||${ce};self.${j}=${oe};`)+s},nonce:t})),de=u.createContext({preferNative:!0,hasProvider:!1}),z=({ratio:r=1,preferNative:t,nonce:s,children:n,...l})=>{let a=ie(),o=u.useRef(),i=u.useContext(de),c=t??i.preferNative,m=l.as||"span";return g(()=>{c&&self[x]===1||o.current&&(self[j]=T)(0,r,o.current)},[n,c,r]),g(()=>{if(!(c&&self[x]===1))return()=>{if(!o.current)return;let f=o.current[M];f&&(f.disconnect(),delete o.current[M])}},[c]),u.createElement(u.Fragment,null,u.createElement(m,{...l,"data-br":a,"data-brr":r,ref:o,style:{display:"inline-block",verticalAlign:"top",textDecoration:"inherit",textWrap:c?"balance":"initial"},suppressHydrationWarning:!0},n),ue(i.hasProvider,s,`self.${j}("${a}",${r})`))},me=z;function xe(r){return e.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",...r,children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M10 15h4V9h-4v6Zm0 2v3a1 1 0 0 1-2 0v-3H5a1 1 0 0 1 0-2h3V9H5a1 1 0 1 1 0-2h3V4a1 1 0 1 1 2 0v3h4V4a1 1 0 0 1 2 0v3h3a1 1 0 0 1 0 2h-3v6h3a1 1 0 0 1 0 2h-3v3a1 1 0 0 1-2 0v-3h-4Z"})})}function fe(){return e.jsx("i",{className:"icon-[mingcute--thumb-up-line]"})}const he=()=>e.jsx("svg",{version:"1.1",x:"0px",y:"0px",width:"59.227px",height:"59.227px",viewBox:"0 0 59.227 59.227",className:"fill-current",children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{d:`M51.586,10.029c-0.333-0.475-0.897-0.689-1.449-0.607c-0.021-0.005-0.042-0.014-0.063-0.017L27.469,6.087
			c-0.247-0.037-0.499-0.01-0.734,0.076L8.63,12.799c-0.008,0.003-0.015,0.008-0.023,0.011c-0.019,0.008-0.037,0.02-0.057,0.027
			c-0.099,0.044-0.191,0.096-0.276,0.157c-0.026,0.019-0.051,0.038-0.077,0.059c-0.093,0.076-0.178,0.159-0.249,0.254
			c-0.004,0.006-0.01,0.009-0.014,0.015L0.289,23.78c-0.293,0.401-0.369,0.923-0.202,1.391c0.167,0.469,0.556,0.823,1.038,0.947
			l6.634,1.713v16.401c0,0.659,0.431,1.242,1.062,1.435l24.29,7.422c0.008,0.004,0.017,0.001,0.025,0.005
			c0.13,0.036,0.266,0.059,0.402,0.06c0.003,0,0.007,0.002,0.011,0.002l0,0h0.001c0.143,0,0.283-0.026,0.423-0.067
			c0.044-0.014,0.085-0.033,0.13-0.052c0.059-0.022,0.117-0.038,0.175-0.068l17.43-9.673c0.477-0.265,0.772-0.767,0.772-1.312
			V25.586l5.896-2.83c0.397-0.19,0.69-0.547,0.802-0.973c0.111-0.427,0.03-0.88-0.223-1.241L51.586,10.029z M27.41,9.111
			l17.644,2.59L33.35,17.143l-18.534-3.415L27.41,9.111z M9.801,15.854l21.237,3.914l-6.242,9.364l-20.78-5.365L9.801,15.854z
			 M10.759,43.122V28.605l14.318,3.697c0.125,0.031,0.25,0.048,0.375,0.048c0.493,0,0.965-0.244,1.248-0.668l5.349-8.023v25.968
			L10.759,43.122z M49.479,41.1l-14.431,8.007V25.414l2.635,5.599c0.171,0.361,0.479,0.641,0.854,0.773
			c0.163,0.06,0.333,0.087,0.502,0.087c0.223,0,0.444-0.05,0.649-0.146l9.789-4.698L49.479,41.1L49.479,41.1z M39.755,28.368
			l-4.207-8.938L49.85,12.78l5.634,8.037L39.755,28.368z`})})})}),A=d.forwardRef,pe=C(null),ge=A((r,t)=>{const{children:s,show:n=!0,...l}=r,{className:a,...o}=l;return e.jsx(I,{mode:"wait",children:n&&e.jsx(_.button,{ref:t,"aria-label":"Floating action button",initial:{opacity:.3,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:.3,scale:.8},className:$("mt-2 flex items-center justify-center","h-12 w-12 text-lg md:h-10 md:w-10 md:text-base","border border-accent outline-accent hover:opacity-100 focus:opacity-100 focus:outline-none","rounded-xl border border-zinc-400/20 shadow-lg backdrop-blur-lg dark:border-zinc-500/30 dark:bg-zinc-800/80 dark:text-zinc-200","bg-slate-50/80 shadow-lg dark:bg-neutral-900/80","transition-all duration-500 ease-in-out",a),...o,children:s})})});A((r,t)=>{const{onClick:s,children:n}=r,l=d.useId(),a=se(pe);return a?e.jsx(B,{to:a,children:e.jsx(ge,{ref:t,id:l,onClick:s,children:n})}):null});const je=({children:r,className:t})=>e.jsx("ul",{className:v("shiro-timeline",t),children:r});d.memo(function(t){const{count:s,name:n}=t;return e.jsx(H,{count:s,text:n,onClick:t.onClick,passProps:t})});const ye=r=>{const{name:t}=r,{data:s,isLoading:n}=L({queryKey:[t,"tag"],queryFn:async({queryKey:a})=>{const[o]=a;return(await E.category.getTagByName(o)).data},staleTime:1e3*60*60*24}),{dismissAll:l}=R();return n?e.jsx("div",{className:"h-30 loading-dots flex w-full center"}):s?e.jsx(je,{children:s.map(a=>e.jsx("li",{className:"flex items-center justify-between","data-id":a.id,children:e.jsxs("span",{className:"flex min-w-0 flex-shrink items-center",children:[e.jsx("span",{className:"mr-2 inline-block w-12 tabular-nums",children:Intl.DateTimeFormat("en-us",{month:"2-digit",day:"2-digit"}).format(new Date(a.created))}),e.jsx(y,{onClick:()=>{l()},prefetch:!1,href:P(S.Post,{category:a.category.slug,slug:a.slug}),className:"min-w-0 truncate leading-6",children:e.jsx("span",{className:"min-w-0 truncate",children:a.title})})]})},a.id))}):e.jsx(he,{})},F=({className:r,meta:t})=>{var n,l,a,o;const{present:s}=R();return e.jsxs("div",{className:$("flex min-w-0 flex-shrink flex-grow flex-wrap gap-2 text-sm",r),children:[e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[!!t.created&&e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx("span",{children:e.jsx(p,{date:t.created})})]}),!!t.modified&&e.jsxs(W,{wrapperClassName:"text-xs",as:"span",type:"tooltip",TriggerComponent:()=>"(已编辑)",children:["编辑于 ",e.jsx(p,{date:t.modified})]})]}),!!t.category&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx(xe,{className:"translate-y-[0.5px]"}),e.jsxs("span",{className:"min-w-0 truncate",children:[e.jsx(y,{href:P(S.Category,{slug:t.category.slug}),className:"shiro-link--underline font-normal",children:(n=t.category)==null?void 0:n.name}),(l=t.tags)!=null&&l.length?e.jsxs(e.Fragment,{children:[" ","/"," ",t.tags.map((i,c)=>{const m=c===t.tags.length-1;return e.jsxs(d.Fragment,{children:[e.jsx("button",{className:"shiro-link--underline",onClick:()=>s({content:()=>e.jsx(ye,{name:i}),title:`Tag: ${i}`}),children:i},i),!m&&e.jsx("span",{children:", "})]},i)})]}):""]})]}),!!((a=t.count)!=null&&a.read)&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx("i",{className:"icon-[mingcute--eye-2-line]"}),e.jsx("span",{className:"min-w-0 truncate",children:t.count.read})]}),!!((o=t.count)!=null&&o.like)&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx(fe,{}),e.jsx("span",{className:"min-w-0 truncate",children:e.jsx(U,{children:t.count.like})})]})]})},ve=()=>{const r=h(t=>t==null?void 0:t.text);return r?e.jsx(D,{allowsScript:!0,value:r,className:"min-w-0 overflow-hidden"}):null},we=r=>{const t=h(s=>(s==null?void 0:s.images)||w);return e.jsx(ee,{images:t||w,children:r.children})},be=({className:r})=>{const t=h(s=>{if(s)return{created:s.created,category:s.category,tags:s.tags,count:s.count,modified:s.modified}});return t?e.jsx(F,{meta:t,className:r}):null},Ne=({pin:r,id:t})=>{const[s,n]=d.useState(r);return e.jsx(re,{onPinChange:async l=>{await E.post.proxy(t).patch({data:{pin:l}}),n(l)},pin:s})},ke=()=>{const[r,t]=d.useState(!1),s=d.useRef(null);return d.useEffect(()=>{const n=s.current;if(!n)return;const l=n.parentElement;if(l)return l.onfocus=()=>{t(!0)},l.onblur=()=>{t(!1)},()=>{l.onfocus=null,l.onblur=null}},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:s,className:"absolute inset-0 z-10",onMouseEnter:()=>{t(!0)},onMouseLeave:()=>{t(!1)}}),e.jsx(I,{children:r&&e.jsx(_.div,{layout:!0,initial:{opacity:.2,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},layoutId:"post-item-hover-overlay",className:v("absolute z-[-1] rounded-xl","bg-slate-300/50 dark:bg-neutral-800","bottom-[1rem] left-[-1rem] right-[-1.5rem] top-[1rem]")})})]})};d.memo(function({data:t}){var o,i;const s=t.text.length>300?`${Y(t.text.slice(0,300))}...`:t.text,n=((o=t.images)==null?void 0:o.length)>0&&t.images[0].src,a=`/posts/${(i=t.category)==null?void 0:i.slug}/${t.slug}`;return e.jsxs(y,{href:a,className:"relative flex flex-col py-8 focus-visible:!shadow-none",children:[e.jsx(ke,{}),e.jsxs("h2",{className:"relative break-words text-2xl font-medium",children:[e.jsx(z,{children:t.title}),e.jsx(Ne,{pin:!!t.pin,id:t.id})]}),e.jsxs("main",{className:"relative mt-8 space-y-2",children:[!!t.summary&&e.jsxs("p",{className:"break-all leading-relaxed text-gray-900 dark:text-slate-50",children:["摘要： ",t.summary]}),e.jsxs("div",{className:"relative overflow-hidden text-justify",children:[n&&e.jsx("div",{className:v("float-right mb-2 ml-3 h-[5.5rem] w-[5.5rem] overflow-hidden rounded-md","bg-cover bg-center bg-no-repeat"),style:{backgroundImage:`url(${n})`}}),e.jsx("p",{className:"break-all leading-loose text-gray-800/90 dark:text-gray-200/90",children:s})]})]}),e.jsxs("div",{className:"post-meta-bar mt-2 flex select-none flex-wrap items-center justify-end gap-4 text-base-content/60",children:[e.jsx(F,{meta:t}),e.jsxs("span",{className:"flex flex-shrink-0 select-none items-center space-x-1 text-right text-accent hover:text-accent [&>svg]:hover:ml-2",children:[e.jsx("span",{children:"阅读全文"}),e.jsx("i",{className:"icon-[mingcute--arrow-right-line] text-lg transition-[margin]"})]})]})]})});const Me=()=>{const r=h(t=>t==null?void 0:t.modified);return r&&b().diff(b(r),"day")>60?e.jsx(V,{type:"warning",className:"my-10",children:e.jsxs("span",{className:"leading-[1.8]",children:["这篇文章上次修改于 ",e.jsx(p,{date:r}),"，可能部分内容已经不适用，如有疑问可询问作者。"]})}):null},We=r=>{const{category:t,slug:s}=r,{data:n,isLoading:l}=L({...X.post.bySlug(t,s)});d.useEffect(()=>{const o=history.state,i=window.location.href,c=new URL(i);c.pathname=`/posts/${t}/${s}`;const m=c.href;return history.replaceState(null,"",m),()=>{history.replaceState(o,"",i)}},[t,s]);const a=d.useMemo(()=>C(null),[]);return l?e.jsx(q,{className:"w-full",useDefaultLoadingText:!0}):n?e.jsxs(Z,{overrideAtom:a,children:[e.jsx(K,{data:n}),e.jsx(Q,{children:e.jsxs("article",{className:"prose relative w-full min-w-0",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-center",children:e.jsx(me,{children:n.title})}),e.jsx(be,{className:"mb-8 justify-center"}),e.jsx(G,{cid:J(n)}),e.jsx(Me,{})]}),e.jsx(te,{children:e.jsx(we,{children:e.jsx(ve,{})})})]})})]}):null};export{We as PostPreview};
