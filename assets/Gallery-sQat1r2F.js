import{r as u,j as s,R as de,i as Z}from"./index-UszForRq.js";import{c as Se,u as Le,L as Oe,D as ie,a as Ne}from"./Divider-ohHU5HmP.js";import{c as le,s as Re,a as M}from"./helper-H2rpVDS9.js";import{a as D,j as Ae,u as ue,s as Te,i as _e}from"./utils-JxBG2tY2.js";const He=n=>{const e=u.useRef();return e.current||(e.current=n()),e.current},me=u.createContext(D([])),St=({children:n,images:e})=>{const o=He(()=>D(e));return u.useEffect(()=>{Ae.set(o,e)},[e]),s.jsx(me.Provider,{value:o,children:n})},ee=n=>ue(Te(u.useContext(me),u.useCallback(e=>e.find(o=>o.src===n),[n]))),Pe=typeof window<"u"?u.useLayoutEffect:u.useEffect,ke=({contexts:n,children:e})=>n.reduceRight((o,r)=>de.cloneElement(r,{children:o}),e),Q=n=>{const e=u.useRef(n);return u.useEffect(()=>{e.current=n},[n]),e};D(!1);const We=(n,e,o={})=>{let r,c,i;const v=()=>{r=void 0,c!==void 0&&(n.apply(void 0,c),c=void 0,i=Date.now(),r=setTimeout(v,e))};return function(...m){const z=Date.now();i===void 0&&o.leading===!1&&(i=z);const g=e-(z-(i??0));g<=0||g>e?(r!==void 0&&clearTimeout(r),n.apply(this,m),i=z,r=setTimeout(v,e)):o.trailing!==!1&&(c=m,r===void 0&&(r=setTimeout(v,g)))}},Lt=n=>n[Math.floor(Math.random()*n.length)];D(0);const Me=D(null),De=()=>ue(Me),[$e,Ue,Fe]=Z(void 0),[Ge,Ye,Ze]=Z({h:0,w:0}),[qe,Ot,Be]=Z({x:0,y:0}),[Ve,Nt,Xe]=Z(!1),Ke=[s.jsx($e,{},"ArticleElementProviderInternal"),s.jsx(Ge,{},"ElementSizeProviderInternal"),s.jsx(qe,{},"ElementPositsionProviderInternal"),s.jsx(Ve,{},"IsEOArticleElementProviderInternal")],Rt=({children:n,className:e})=>s.jsxs(ke,{contexts:Ke,children:[s.jsx(Je,{}),s.jsx(fe,{className:e,children:n})]}),Je=()=>{const n=Ze(),e=Be(),o=Ue();return Pe(()=>{if(!o)return;const{height:r,width:c,x:i,y:v}=o.getBoundingClientRect();n({h:r,w:c}),e({x:i,y:v});const m=new ResizeObserver(z=>{const g=z[0],{height:j,width:S,x:N,y:C}=g.contentRect;n({h:j,w:S}),e({x:N,y:C})});return m.observe(o),()=>{m.unobserve(o),m.disconnect()}},[o]),null},fe=u.memo(({children:n,className:e})=>{const o=Fe();return s.jsxs("div",{className:le("relative",e),ref:o,children:[n,s.jsx(Qe,{})]})});fe.displayName="ArticleElementProviderContent";const Qe=()=>{const n=De(),e=Q(n),o=Xe(),r=u.useRef(null);return u.useEffect(()=>{if(!r.current)return;const c=r.current,i=new IntersectionObserver(v=>{const m=v[0];!m.isIntersecting&&e.current==="down"||o(m.isIntersecting)},{rootMargin:"0px 0px 0px 0px"});return i.observe(c),()=>{i.unobserve(c),i.disconnect()}},[]),s.jsx("div",{ref:r})};/*! medium-zoom 1.1.0 | MIT License | https://github.com/francoischalifour/medium-zoom */var _=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n},F=function(e){return e.tagName==="IMG"},et=function(e){return NodeList.prototype.isPrototypeOf(e)},G=function(e){return e&&e.nodeType===1},ae=function(e){var o=e.currentSrc||e.src;return o.substr(-4).toLowerCase()===".svg"},se=function(e){try{return Array.isArray(e)?e.filter(F):et(e)?[].slice.call(e).filter(F):G(e)?[e].filter(F):typeof e=="string"?[].slice.call(document.querySelectorAll(e)).filter(F):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},tt=function(e){var o=document.createElement("div");return o.classList.add("medium-zoom-overlay"),o.style.background=e,o},nt=function(e){var o=e.getBoundingClientRect(),r=o.top,c=o.left,i=o.width,v=o.height,m=e.cloneNode(),z=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,g=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return m.removeAttribute("id"),m.style.position="absolute",m.style.top=r+z+"px",m.style.left=c+g+"px",m.style.width=i+"px",m.style.height=v+"px",m.style.transform="",m},k=function(e,o){var r=_({bubbles:!1,cancelable:!1,detail:void 0},o);if(typeof window.CustomEvent=="function")return new CustomEvent(e,r);var c=document.createEvent("CustomEvent");return c.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),c},ot=function n(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=window.Promise||function(a){function d(){}a(d,d)},c=function(a){var d=a.target;if(d===$){h();return}E.indexOf(d)!==-1&&R({target:d})},i=function(){if(!(H||!t.original)){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(oe-a)>f.scrollOffset&&setTimeout(h,150)}},v=function(a){var d=a.key||a.keyCode;(d==="Escape"||d==="Esc"||d===27)&&h()},m=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a;if(a.background&&($.style.background=a.background),a.container&&a.container instanceof Object&&(d.container=_({},f.container,a.container)),a.template){var p=G(a.template)?a.template:document.querySelector(a.template);d.template=p}return f=_({},f,d),E.forEach(function(y){y.dispatchEvent(k("medium-zoom:update",{detail:{zoom:x}}))}),x},z=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return n(_({},f,a))},g=function(){for(var a=arguments.length,d=Array(a),p=0;p<a;p++)d[p]=arguments[p];var y=d.reduce(function(l,w){return[].concat(l,se(w))},[]);return y.filter(function(l){return E.indexOf(l)===-1}).forEach(function(l){E.push(l),l.classList.add("medium-zoom-image")}),T.forEach(function(l){var w=l.type,O=l.listener,P=l.options;y.forEach(function(A){A.addEventListener(w,O,P)})}),x},j=function(){for(var a=arguments.length,d=Array(a),p=0;p<a;p++)d[p]=arguments[p];t.zoomed&&h();var y=d.length>0?d.reduce(function(l,w){return[].concat(l,se(w))},[]):E;return y.forEach(function(l){l.classList.remove("medium-zoom-image"),l.dispatchEvent(k("medium-zoom:detach",{detail:{zoom:x}}))}),E=E.filter(function(l){return y.indexOf(l)===-1}),x},S=function(a,d){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return E.forEach(function(y){y.addEventListener("medium-zoom:"+a,d,p)}),T.push({type:"medium-zoom:"+a,listener:d,options:p}),x},N=function(a,d){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return E.forEach(function(y){y.removeEventListener("medium-zoom:"+a,d,p)}),T=T.filter(function(y){return!(y.type==="medium-zoom:"+a&&y.listener.toString()===d.toString())}),x},C=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.target,p=function(){var l={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},w=void 0,O=void 0;if(f.container)if(f.container instanceof Object)l=_({},l,f.container),w=l.width-l.left-l.right-f.margin*2,O=l.height-l.top-l.bottom-f.margin*2;else{var P=G(f.container)?f.container:document.querySelector(f.container),A=P.getBoundingClientRect(),B=A.width,pe=A.height,ve=A.left,ye=A.top;l=_({},l,{width:B,height:pe,left:ve,top:ye})}w=w||l.width-f.margin*2,O=O||l.height-f.margin*2;var W=t.zoomedHd||t.original,ze=ae(W)?w:W.naturalWidth||w,xe=ae(W)?O:W.naturalHeight||O,U=W.getBoundingClientRect(),Ee=U.top,be=U.left,V=U.width,X=U.height,we=Math.min(Math.max(V,ze),w)/V,Ie=Math.min(Math.max(X,xe),O)/X,K=Math.min(we,Ie),je=(-be+(w-V)/2+f.margin+l.left)/K,Ce=(-Ee+(O-X)/2+f.margin+l.top)/K,re="scale("+K+") translate3d("+je+"px, "+Ce+"px, 0)";t.zoomed.style.transform=re,t.zoomedHd&&(t.zoomedHd.style.transform=re)};return new r(function(y){if(d&&E.indexOf(d)===-1){y(x);return}var l=function B(){H=!1,t.zoomed.removeEventListener("transitionend",B),t.original.dispatchEvent(k("medium-zoom:opened",{detail:{zoom:x}})),y(x)};if(t.zoomed){y(x);return}if(d)t.original=d;else if(E.length>0){var w=E;t.original=w[0]}else{y(x);return}if(t.original.dispatchEvent(k("medium-zoom:open",{detail:{zoom:x}})),oe=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,H=!0,t.zoomed=nt(t.original),document.body.appendChild($),f.template){var O=G(f.template)?f.template:document.querySelector(f.template);t.template=document.createElement("div"),t.template.appendChild(O.content.cloneNode(!0)),document.body.appendChild(t.template)}if(t.original.parentElement&&t.original.parentElement.tagName==="PICTURE"&&t.original.currentSrc&&(t.zoomed.src=t.original.currentSrc),document.body.appendChild(t.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),t.original.classList.add("medium-zoom-image--hidden"),t.zoomed.classList.add("medium-zoom-image--opened"),t.zoomed.addEventListener("click",h),t.zoomed.addEventListener("transitionend",l),t.original.getAttribute("data-zoom-src")){t.zoomedHd=t.zoomed.cloneNode(),t.zoomedHd.removeAttribute("srcset"),t.zoomedHd.removeAttribute("sizes"),t.zoomedHd.removeAttribute("loading"),t.zoomedHd.src=t.zoomed.getAttribute("data-zoom-src"),t.zoomedHd.onerror=function(){clearInterval(P),console.warn("Unable to reach the zoom image target "+t.zoomedHd.src),t.zoomedHd=null,p()};var P=setInterval(function(){t.zoomedHd.complete&&(clearInterval(P),t.zoomedHd.classList.add("medium-zoom-image--opened"),t.zoomedHd.addEventListener("click",h),document.body.appendChild(t.zoomedHd),p())},10)}else if(t.original.hasAttribute("srcset")){t.zoomedHd=t.zoomed.cloneNode(),t.zoomedHd.removeAttribute("sizes"),t.zoomedHd.removeAttribute("loading");var A=t.zoomedHd.addEventListener("load",function(){t.zoomedHd.removeEventListener("load",A),t.zoomedHd.classList.add("medium-zoom-image--opened"),t.zoomedHd.addEventListener("click",h),document.body.appendChild(t.zoomedHd),p()})}else p()})},h=function(){return new r(function(a){if(H||!t.original){a(x);return}var d=function p(){t.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(t.zoomed),t.zoomedHd&&document.body.removeChild(t.zoomedHd),document.body.removeChild($),t.zoomed.classList.remove("medium-zoom-image--opened"),t.template&&document.body.removeChild(t.template),H=!1,t.zoomed.removeEventListener("transitionend",p),t.original.dispatchEvent(k("medium-zoom:closed",{detail:{zoom:x}})),t.original=null,t.zoomed=null,t.zoomedHd=null,t.template=null,a(x)};H=!0,document.body.classList.remove("medium-zoom--opened"),t.zoomed.style.transform="",t.zoomedHd&&(t.zoomedHd.style.transform=""),t.template&&(t.template.style.transition="opacity 150ms",t.template.style.opacity=0),t.original.dispatchEvent(k("medium-zoom:close",{detail:{zoom:x}})),t.zoomed.addEventListener("transitionend",d)})},R=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.target;return t.original?h():C({target:d})},q=function(){return f},I=function(){return E},L=function(){return t.original},E=[],T=[],H=!1,oe=0,f=o,t={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(e)==="[object Object]"?f=e:(e||typeof e=="string")&&g(e),f=_({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},f);var $=tt(f.background);document.addEventListener("click",c),document.addEventListener("keyup",v),document.addEventListener("scroll",i),window.addEventListener("resize",h);var x={open:C,close:h,toggle:R,update:m,clone:z,attach:g,detach:j,on:S,off:N,getOptions:q,getImages:I,getZoomedImage:L};return x};function rt(n,e){e===void 0&&(e={});var o=e.insertAt;if(!(!n||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",o==="top"&&r.firstChild?r.insertBefore(c,r.firstChild):r.appendChild(c),c.styleSheet?c.styleSheet.cssText=n:c.appendChild(document.createTextNode(n))}}var it=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";rt(it);const at=ot,st=n=>de.createElement("img",n,n.children),ct="_error_hef56_1",dt="_loading_hef56_2",lt="_loaded_hef56_6",ut="_imageLoad_hef56_1",ce={error:ct,loading:dt,loaded:lt,imageLoad:ut},te=Re({base:"rounded-xl overflow-hidden text-center inline-flex items-center justify-center duration-200",variants:{status:{loading:"hidden opacity-0",loaded:"opacity-100 block",error:"hidden opacity-0"}}});let J;const mt=({alt:n,src:e,title:o,zoom:r,placeholder:c,height:i,width:v})=>{const[m]=u.useState(()=>{if(_e)return null;if(J)return J;const h=at(void 0);return J=h,h}),z=o||n,[g,j]=u.useState("loading"),S=Le(),N=u.useCallback(h=>{S.current||j(h)},[S]),C=u.useRef(null);return u.useEffect(()=>{if(g!=="loaded"||!r)return;const h=C.current;if(h)return m.attach(h),()=>{m.detach(h)}},[r,m,g]),s.jsxs("figure",{children:[s.jsx("span",{className:"relative flex justify-center","data-hide-print":!0,children:s.jsxs(Oe,{placeholder:c,offset:30,children:[s.jsx("span",{children:g!=="loaded"&&c}),g==="error"&&s.jsxs("div",{className:"absolute inset-0 z-[1] flex flex-col gap-8 center",children:[s.jsx("i",{className:"icon-[mingcute--close-line] text-4xl text-red-500"}),s.jsx("span",{children:"图片加载失败"}),s.jsx(ie,{className:"w-[80px] opacity-80"}),s.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:s.jsx("span",{children:"查看原图"})})]}),s.jsx(he,{height:i,width:v,src:e,title:o,alt:n||o||"",ref:C,onLoad:()=>{N("loaded")},onError:()=>N("error"),className:te({status:g,className:ce.loaded}),onAnimationEnd:h=>{h.target.classList.remove(ce.loaded)}})]})}),s.jsx("img",{className:"max-w-1/3 hidden print:block",src:e,alt:n||o}),!!z&&s.jsxs("figcaption",{className:"mt-1 flex flex-col items-center justify-center",children:[s.jsx(ie,{className:"w-[80px] opacity-80"}),s.jsx("span",{children:z})]})]})},ft=n=>{const e=u.useMemo(()=>s.jsx(ht,{...n}),[n]);return s.jsx(mt,{zoom:!0,placeholder:e,...n})},ht=({src:n,containerWidth:e,height:o,width:r,accent:c})=>{const i=ee(n),v=c||(i==null?void 0:i.accent),m=u.useMemo(()=>{let z=o,g=r;if(!z||!g){if(!i)return;z=i.height,g=i.width}if(e<=0)return;const{height:j,width:S}=Se({width:g,height:z,max:{width:e,height:1/0}});return{scaleHeight:j,scaleWidth:S}},[o,r,e,i]);return m?s.jsx("span",{className:`image-placeholder ${te.base}`,"data-width":m.scaleWidth,"data-height":m.scaleHeight,"data-from-record-height":i==null?void 0:i.height,"data-from-record-width":i==null?void 0:i.width,"data-src":n,style:{height:m.scaleHeight,width:m.scaleWidth,backgroundColor:v}}):s.jsx(gt,{accent:v})},gt=({accent:n})=>s.jsx("span",{className:le("image-placeholder",te.base,"h-[300px] w-full bg-slate-300 dark:bg-slate-700"),style:{backgroundColor:n,outline:void 0}}),he=u.forwardRef(({src:n,alt:e,...o},r)=>{const{height:c,width:i}=ee(n)||o;return!c||!i?s.jsx("img",{alt:e,src:n,ref:r,...o}):s.jsx(st,{alt:e||"",fetchPriority:"high",priority:!0,src:n,...o,height:+c,width:+i,ref:r})});he.displayName="OptimizedImage";const pt="_root_1ug9l_1",vt="_indicator_1ug9l_2",yt="_container_1ug9l_7",zt="_child_1ug9l_17",Y={root:pt,indicator:vt,container:yt,child:zt},ne=60,xt=15,Et=5e3,At=n=>{const{images:e}=n,[o,r]=u.useState(null),[,c]=u.useState({}),i=u.useRef(0);u.useEffect(()=>{if(!o)return;const I=new ResizeObserver(()=>{c({}),L(o)});function L(E){const T=E.children.item(0);T&&(i.current=T.clientWidth)}return L(o),I.observe(o),()=>{I.disconnect()}},[o]);const[v,m]=u.useState(0),z=u.useCallback(We(I=>{const L=I.target,E=Math.floor((L.scrollLeft+ne+15)/i.current);m(E)},60),[]),g=u.useCallback(I=>{o&&o.scrollTo({left:i.current*I,behavior:"smooth"})},[o]),j=u.useRef(null),S=Q(v),N=Q(e.length),C=u.useRef(!0),h=u.useRef(!0),R=u.useCallback(()=>{h.current&&(h.current=!1,clearInterval(j.current))},[]),{ref:q}=Ne({initialInView:!1,triggerOnce:e.length<2,onChange(I){N.current<2||!h.current||(I?j.current=setInterval(()=>{S.current+1>N.current-1&&C.current&&(C.current=!1),S.current-1<0&&!C.current&&(C.current=!0);const L=S.current+(C.current?1:-1);g(L)},Et):j.current=clearInterval(j.current))}});return u.useEffect(()=>()=>{clearInterval(j.current)},[]),s.jsxs("div",{className:M("w-full","relative",Y.root),ref:q,onTouchMove:R,onWheel:R,children:[s.jsx("div",{className:M("w-full overflow-auto whitespace-nowrap",Y.container),onTouchStart:R,onScroll:z,ref:r,onTouchMove:R,onWheel:R,children:e.map(I=>s.jsx(ge,{image:I},I.url))}),s.jsx("div",{className:M(Y.indicator,"space-x-2"),children:Array.from({length:e.length}).map((I,L)=>s.jsx("div",{className:M("h-[6px] w-[6px] cursor-pointer rounded-full bg-stone-600 opacity-50 transition-opacity duration-200 ease-in-out",v==L&&"!opacity-100"),onClick:g.bind(null,L)},L))})]})},bt={width:`calc(100% - ${ne}px)`,marginRight:`${xt}px`},ge=u.memo(({image:n})=>{const e=ee(n.url),o=n.name,c=n.footnote||(["!","¡"].some(v=>v==(o==null?void 0:o[0]))?o==null?void 0:o.slice(1):"")||"",{w:i}=Ye();return s.jsx("div",{style:bt,className:M(Y.child,"inline-block self-center"),children:s.jsx(ft,{accent:e==null?void 0:e.accent,src:n.url,alt:c,containerWidth:i-ne})},`${n.url}-${n.name||""}`)});ge.displayName="GalleryItem";export{ft as F,At as G,st as I,St as M,Rt as W,He as a,Lt as s,Ye as u};
